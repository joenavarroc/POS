<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cafeter√≠a Did√°ctica</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Aclonica&family=Kavivanar&family=Permanent+Marker&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  

  <style>
  /* Estilo global */
body {
  position: relative;
  background: url('https://cdn.pixabay.com/photo/2016/03/05/22/16/coffee-1239226_1280.jpg') center/cover no-repeat fixed;
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(2px);
  z-index: -1;
}

.bg-body {
  background: url('https://cdn.pixabay.com/photo/2016/03/05/22/16/coffee-1239226_1280.jpg') center/cover no-repeat fixed;
  min-height: 100vh;
}

.container-fluid {
  padding-bottom: 7rem; /* Esto asegura que el contenido no se solape con la navbar */
}

.contenido-flotante {
  background-color: rgba(255, 255, 255, 0.281);
  border-radius: 10px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(3px);
  padding: 2rem;
  margin: 1rem auto;
  max-width: 1400px;
  width: 100%;
  position: relative;
  padding-bottom: 7rem; /* Espacio extra para el navbar */
}

/* Estilos para productos */
.producto {
  width: 45%;
  flex: 1 1 140px;
  max-width: 180px;
  height: auto;
  background-color: #f2f2f2;
  border-radius: 10px;
  margin: 10px;
  text-align: center;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.producto:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
}

.producto img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

.producto-info {
  padding: 5px;
  background-color: white;
  flex-grow: 1;
}

.producto-info h6 {
  color: rgb(0, 0, 0) !important;
  margin: 4px 0 2px;
  font-size: 14px;
}

.producto-info p {
  margin: 0;
  font-size: 13px;
  color: #555;
}

#btnNuevoProducto {
  display: none;
}

/* Navbar inferior */
.navbar-inferior {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #000000cc;
  box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
  display: flex;
  justify-content: space-around;
  padding: 10px 0;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease-in-out;
  z-index: 10000; /* Aseg√∫rate de que est√© por encima del contenido */
}

body:hover .navbar-inferior {
  opacity: 1;
  pointer-events: auto;
}

/* Factura Box */
.factura-box {
  max-height: 75vh;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  color: #f8f9fa;
}

#factura {
  max-height: 50vh;
  overflow-y: auto;
  margin-bottom: 1rem;
  border: 1px solid #dee2e6;
  border-radius: 5px;
  padding-right: 5px;
}

#previewImagenes img {
  width: 64px;
  height: 64px;
  object-fit: cover;
  border: 2px solid transparent;
  border-radius: 6px;
  cursor: pointer;
  transition: border 0.2s ease;
}

#previewImagenes img:hover {
  border-color: #0d6efd;
}

#lista-productos {
  max-height: 70vh;
  overflow-y: auto;
}

/* Fuentes personalizadas */
.aclonica-regular {
  font-family: "Aclonica", sans-serif;
  font-weight: 500;
  font-style: normal;
  color: aliceblue;
}

#btnConfigNegocio {
  background-color: rgba(255, 255, 255, 0.05);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  padding: 0.3rem 0.6rem;
  font-size: 1.2rem;
  transition: all 0.3s ease;
}

#btnConfigNegocio:hover {
  background-color: rgba(255, 255, 255, 0.15);
  transform: rotate(15deg) scale(1.05);
}

/* Media Queries */
@media (max-width: 768px) {
  .contenido-flotante {
    margin: 10px auto;
    padding: 1rem;
  }

  .producto {
    flex: 1 1 48%;
    max-width: 48%;
  }

  .producto-info h6,
  .producto-info p {
    font-size: 12px;
  }
}

@media (max-width: 576px) {
  .contenido-flotante {
    padding: 1rem;
    margin: 0.5rem;
  }

  .producto {
    flex: 1 1 100%;
    max-width: 100%;
  }

  .factura-box h3,
  .factura-box h4,
  .btn,
  .form-select {
    font-size: 0.9rem;
  }
}

/* Estilos para las categor√≠as */
#productosCategoriaContainer {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: flex-start;
}

.categoria-card {
  flex: 0 0 20%; /* Las tarjetas de categor√≠a ocupan un 22% del ancho */
  max-width: 22%; /* Limitar el ancho m√°ximo */
  height: auto; /* Mantener el alto autom√°tico */
  background-color: #f2f2f2;
  border-radius: 10px;
  margin: 10px;
  text-align: center;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  flex-shrink: 0; /* Impide que las tarjetas se ajusten */
}

.categoria-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
}

.categoria-img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

.categoria-nombre {
  padding: 5px;
  background-color: white;
  flex-grow: 1;
  font-size: 14px;
  font-weight: bold;
}
#btnNuevaCategoria {
  display: none;
}

.modo-edicion #btnNuevaCategoria {
  display: inline-block;
}

.modo-facturacion #btnNuevaCategoria {
  display: none;
}

.solo-edicion {
  display: none;
}

.modo-edicion .solo-edicion {
  display: inline-block !important;
}

.modo-facturacion .solo-edicion {
  display: none;
}

/* Media Queries para pantallas peque√±as */
@media (max-width: 1200px) {
  .categoria-card {
    flex: 0 0 30%; /* En pantallas medianas, las tarjetas ocupan un 30% del ancho */
    max-width: 30%;
  }
}

@media (max-width: 768px) {
  .categoria-card {
    flex: 0 0 48%; /* En pantallas peque√±as, las tarjetas ocupan un 48% del ancho */
    max-width: 48%;
  }
}

@media (max-width: 576px) {
  .categoria-card {
    flex: 0 0 100%; /* En pantallas muy peque√±as, las tarjetas ocupan el 100% del ancho */
    max-width: 100%;
  }
}

#contenedorCategoriasScroll {
  max-height: 70vh;  /* Ajust√° seg√∫n el dise√±o */
  overflow-y: auto;
  padding-right: 10px; /* Para espacio al scrollbar */
}

#listaCategorias {
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-start;
  gap: 20px;
}


  </style>
  
  <body class="bg-body">
    <div class="container-fluid contenido-flotante py-4">
      <h1 class="mb-4 aclonica-regular text-center text-lg-start">
        <span id="nombreNegocioTexto">Coffe Store</span>
        <button id="btnConfigNegocio" class="btn btn-sm btn-outline-light ms-2" style="display: none;" onclick="abrirModalConfiguracion()">
          ‚öôÔ∏è
        </button>        
      </h1>
    
      <div class="row g-4">
        <!-- Columna Categorias -->
        <div class="col-12 col-lg-8">
          <div class="input-group mb-3">
            <span class="input-group-text">üîç</span>
            <input type="text" id="busquedaProducto" class="form-control" placeholder="Buscar producto por nombre...">
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="text-light mb-0">Categor√≠as</h4>
            <button id="btnNuevaCategoria" class="btn btn-primary solo-edicion">‚ûï Nueva Categor√≠a</button>
          </div>
          <!-- Resultados (inicialmente ocultos) -->
          <div id="resultadosBusqueda" class="d-flex flex-wrap gap-3 mt-3" style="display: none;"></div>

          <!-- Categor√≠as -->
          <div id="lista-categorias" class="d-flex flex-wrap gap-3"></div>  
        </div>
  
        <!-- Columna factura -->
        <div class="col-12 col-lg-4">
          <div class="factura-box">
            <h3 class="mt-3 mt-md-0">Factura</h3>
            <ul id="factura" class="list-group mb-3" style="max-height: 300px; overflow-y: auto;"></ul>
            <div><strong>Subtotal:</strong> $<span id="subtotal">0.00</span></div>
  
            <h4 class="mt-4">M√©todo de pago</h4>
            <select id="metodoPago" class="form-select mb-3">
              <option value="efectivo">Efectivo</option>
              <option value="tarjeta">Tarjeta</option>
              <option value="transferencia">Transferencia</option>
              <option value="mercado_pago">Mercado Pago</option>
            </select>
            <button class="btn btn-primary w-100 mb-3" onclick="finalizarVenta()">Finalizar Venta</button>
            <div id="modoFacturacion" class="mt-4" style="display: none;"></div>
          </div>
        </div>
      </div> <!-- cierra row -->
    </div> <!-- cierra container-fluid -->
  

</div> <!-- cierra col-md-4 -->
</div> <!-- cierra .row -->
</div> <!-- cierra .container -->

  <!-- Modal Nueva Categor√≠a -->
  <div class="modal fade" id="modalCategoria" tabindex="-1" >
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-white">
        <form id="formCategoria">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCategoriaLabel">Nueva Categor√≠a</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="nombreCategoria" class="form-label">Nombre</label>
              <input type="text" class="form-control" id="nombreCategoria" required>
            </div>
            <div class="mb-3">
              <label for="imagenCategoria" class="form-label">Imagen (URL)</label>
              <input type="text" class="form-control" id="imagenCategoria" placeholder="https://...">
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Guardar</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<!-- Modal de productos por categor√≠a -->
<div class="modal fade" id="modalCategoriaProductos" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="modalCategoriaProductosLabel">Productos de la Categor√≠a</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 id="nombreCategoriaModal" class="mb-0"></h6>
          <button id="btnAgregarProductoCategoria" class="btn btn-sm btn-success solo-edicion">+ Producto</button>
        </div>
        <div id="productosCategoriaContainer" class="d-flex flex-wrap gap-3"></div>
      </div>
    </div>
  </div>
</div>

  <!-- Modal para editar/agregar producto -->
  <div class="modal fade" id="modalProducto" tabindex="-1" >
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="formProducto">
          <input type="hidden" id="categoriaProductoId">
          <div class="modal-header">
            <h5 class="modal-title" id="modalProductoLabel">Producto</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="productoId">
            <div class="mb-3">
              <label>Nombre</label>
              <input type="text" id="nombreProducto" class="form-control" required>
            </div>
            <div class="mb-3">
              <label>Precio</label>
              <input type="number" id="precioProducto" class="form-control" step="0.01" required>
            </div>
            <div class="mb-3">
              <label>Imagen (URL o Cargar)</label>
              <input type="text" id="imagenProducto" class="form-control" placeholder="URL de la imagen">
              <input type="file" id="imagenLocal" class="form-control mt-2" accept="image/*">
            </div>
            <div class="mb-3">
              <label>Im√°genes disponibles:</label>
              <div id="previewImagenes" class="d-flex flex-wrap gap-2"></div>
            </div>          
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Guardar</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Calculadora -->
<div class="modal fade" id="modalCalculadora" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="calculadoraLabel">Calculadora</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <input type="text" id="calcDisplay" class="form-control mb-2 text-end" disabled>

        <div class="d-grid gap-2">
          <div class="btn-group w-100">
            <button class="btn btn-secondary" onclick="agregarCalc('7')">7</button>
            <button class="btn btn-secondary" onclick="agregarCalc('8')">8</button>
            <button class="btn btn-secondary" onclick="agregarCalc('9')">9</button>
            <button class="btn btn-warning" onclick="agregarCalc('/')">/</button>
          </div>
          <div class="btn-group w-100">
            <button class="btn btn-secondary" onclick="agregarCalc('4')">4</button>
            <button class="btn btn-secondary" onclick="agregarCalc('5')">5</button>
            <button class="btn btn-secondary" onclick="agregarCalc('6')">6</button>
            <button class="btn btn-warning" onclick="agregarCalc('*')">*</button>
          </div>
          <div class="btn-group w-100">
            <button class="btn btn-secondary" onclick="agregarCalc('1')">1</button>
            <button class="btn btn-secondary" onclick="agregarCalc('2')">2</button>
            <button class="btn btn-secondary" onclick="agregarCalc('3')">3</button>
            <button class="btn btn-warning" onclick="agregarCalc('-')">-</button>
          </div>
          <div class="btn-group w-100">
            <button class="btn btn-secondary" onclick="agregarCalc('0')">0</button>
            <button class="btn btn-secondary" onclick="agregarCalc('.')">.</button>
            <button class="btn btn-danger" onclick="borrarCalc()">C</button>
            <button class="btn btn-warning" onclick="agregarCalc('+')">+</button>
          </div>
          <button class="btn btn-success" onclick="calcular()">=</button>
        </div>
      </div>
    </div>
  </div>
</div>
      <!-- Modal de configuraci√≥n del negocio -->
      <div class="modal fade" id="modalConfiguracion" tabindex="-1" >
        <div class="modal-dialog">
          <div class="modal-content">
            <form id="formConfiguracion">
              <div class="modal-header">
                <h5 class="modal-title" id="modalConfiguracionLabel">‚öôÔ∏è Configuraci√≥n</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="nuevoNombreNegocio" class="form-label">Nombre del negocio</label>
                  <input type="text" class="form-control" id="nuevoNombreNegocio" required>
                </div>
                <div class="mb-3">
                  <label for="nuevaImagenFondo" class="form-label">Imagen de fondo (URL)</label>
                  <input type="text" class="form-control" id="nuevaImagenFondo">
                </div>
                <div class="mb-3">
                  <label for="colorTexto" class="form-label">Color del texto</label>
                  <input type="color" class="form-control form-control-color" id="colorTexto">
                </div>                
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-success">Guardar cambios</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Navbar inferior -->
      <div id="navbarInferior" class="navbar-inferior">
        <button class="btn btn-outline-secondary" onclick="solicitarClaveEdicion()">üìù Edici√≥n</button>
        <button class="btn btn-outline-secondary" onclick="activarModoFacturacion()">üíµ Facturaci√≥n</button>
        <button class="btn btn-outline-secondary" onclick="location.href='ventas.html'">üìä Ventas</button>
        <button class="btn btn-outline-secondary" onclick="location.href='historial.html'">üìÖ Historial</button>
        <button class="btn btn-outline-secondary" onclick="abrirCalculadora()">üßÆ Calculadora</button>
      </div>
      
  
      <script>document.addEventListener('DOMContentLoaded', () => {
        activarModoFacturacion(); // ‚Üê muestra productos disponibles
        
        const datosEdicion = JSON.parse(localStorage.getItem('facturaEnEdicion'));
      
        if (datosEdicion) {
          const { factura } = datosEdicion;
          if (factura && Array.isArray(factura.productos)) {
              window.factura = factura.productos;
              document.getElementById('metodoPago').value = factura.metodoPago || '';
          } else {
              window.factura = [];
          }
        } else {
          window.factura = [];
        }
      
        renderFacturaEnLista();
      });
      
      function renderFacturaEnLista() {
        const lista = document.getElementById('factura');
        lista.innerHTML = ''; // Limpiar la lista antes de renderizar
           
        if (!window.factura || window.factura.length === 0) {
          lista.innerHTML = '';
          return;
        }
      
        let subtotal = 0;
      
        window.factura.forEach((p, i) => {
          const totalItem = p.precio * p.cantidad;
          subtotal += totalItem;
      
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = `
            <div>
              ${p.nombre} x 
              <input type="number" value="${p.cantidad}" min="1" onchange="actualizarCantidad(${i}, this.value)" style="width: 60px;">
            </div>
            <div>
              $${totalItem.toFixed(2)}
              <button class="btn btn-sm btn-danger ms-2" onclick="eliminarProductoDeFactura(${i})">‚ùå</button>
            </div>
          `;
      
          lista.appendChild(li); // Agregar el elemento a la lista
        });
      
        document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`; // Actualizar subtotal
      }
      
      function actualizarCantidad(index, cantidad) {
        cantidad = parseInt(cantidad);
        if (isNaN(cantidad) || cantidad < 1) {
          alert("La cantidad debe ser al menos 1.");
          return;
        }
        window.factura[index].cantidad = cantidad;
        renderFacturaEnLista();
      }
      
      function eliminarProductoDeFactura(index) {
        window.factura.splice(index, 1);
        renderFacturaEnLista();
      }
      
      function guardarFacturaEditada() {
        const datosEdicion = JSON.parse(localStorage.getItem('facturaEnEdicion'));
        const index = datosEdicion.index;
      
        const metodoPago = document.getElementById('metodoPago').value;
        const total = window.factura.reduce((sum, p) => sum + (p.precio * p.cantidad), 0);
      
        const ventas = JSON.parse(localStorage.getItem('ventas')) || [];
      
        ventas[index] = {
          ...ventas[index],
          productos: window.factura,
          metodoPago,
          total
        };
      
        localStorage.setItem('ventas', JSON.stringify(ventas));
        localStorage.removeItem('facturaEnEdicion');
      
        window.location.href = 'ventas.html';
      }
      
      function agregarAFactura(id) {
        const producto = productos.find(p => p.id === id);
        const existente = window.factura.find(p => p.id === id);
      
        if (existente) {
          existente.cantidad += 1;
        } else {
          window.factura.push({ ...producto, cantidad: 1 });
        }
      
        renderFacturaEnLista();
      }
      
      let ventas = [];
      
      function finalizarVenta() {
        if (!window.factura || window.factura.length === 0) {
          alert("No hay productos en la factura.");
          return;
        }
      
        const metodo = document.getElementById("metodoPago").value;
        const fecha = new Date().toISOString().split('T')[0];
        const datosEdicion = JSON.parse(localStorage.getItem('facturaEnEdicion'));
        const ventas = JSON.parse(localStorage.getItem('ventas')) || [];
      
        const total = window.factura.reduce((acc, prod) => acc + prod.precio * (prod.cantidad || 1), 0);
        let venta = null;
      
        if (datosEdicion) {
          const index = datosEdicion.index;
      
          venta = {
            ...ventas[index],
            productos: [...window.factura],
            metodoPago: metodo,
            fecha,
            total
          };
      
          ventas[index] = venta;
          localStorage.removeItem('facturaEnEdicion');
          alert("Factura editada correctamente.");
        } else {
          venta = {
            id: Date.now(),
            productos: [...window.factura],
            metodoPago: metodo,
            fecha,
            total,
            numeroFactura: null
          };
      
          ventas.push(venta);
        }
      
        // Guardar en ventas
        localStorage.setItem('ventas', JSON.stringify(ventas));
      
        // Guardar tambi√©n en historial de cierres
        let historial = JSON.parse(localStorage.getItem('historialCierres')) || [];
        const existente = historial.find(dia => dia.fecha === fecha);
      
        if (existente) {
          existente.ventas.push(venta);
          existente.total += venta.total;
        } else {
          historial.push({
            id: historial.length + 1,
            fecha,
            ventas: [venta],
            total: venta.total
          });
        }
      
        localStorage.setItem('historialCierres', JSON.stringify(historial));
      
        // Mostrar ticket temporal
        let ticket = `üßæ Ticket temporal\n`;
        ticket += `üìÖ Fecha: ${venta.fecha}\n`;
        ticket += `üßç‚Äç‚ôÇÔ∏è M√©todo de pago: ${venta.metodoPago}\n\n`;
        venta.productos.forEach(p => {
          ticket += `‚Ä¢ ${p.nombre} - $${p.precio.toFixed(2)} x${p.cantidad}\n`;
        });
        ticket += `\nüíµ Total: $${venta.total.toFixed(2)}`;
        alert(ticket);
      
        // Limpiar
        window.factura = [];
        renderFacturaEnLista();
      }
      
      function quitarDeFactura(index) {
        if (window.factura[index].cantidad > 1) {
          window.factura[index].cantidad -= 1;
        } else {
          window.factura.splice(index, 1); // Eliminar el producto si ya est√° en 1
        }
        renderFacturaEnLista();
      }    

      //------------------------------------------------------------------------------------------------------------------------------------------------------
      //------------------------------------------------------------------------------------------------------------------------------------------------------

      function agregarProductoAFacturaDesdeCategoria(idCategoria, idProducto) {
        const categoria = categorias.find(c => c.id === idCategoria);
        if (!categoria) return;
      
        const producto = categoria.productos.find(p => p.id === idProducto);
        if (!producto) return;
      
        const existente = factura.find(p => p.id === producto.id);
        if (existente) {
          existente.cantidad++;
        } else {
          factura.push({ ...producto, cantidad: 1 });
        }
      
        renderFactura();
      }
      
// =============================
// üì¶ VARIABLES GLOBALES
// =============================
const STORAGE_KEY = 'categorias';
let modoEdicion = false;
let factura = [];
let categoriaActualId = null;

let categorias = [
  {
    id: 1,
    nombre: 'Cafe',
    imagen: 'https://cdn.pixabay.com/photo/2014/12/11/02/56/coffee-563797_1280.jpg',
    productos: [
      { id: 1, nombre: 'Expreso', precio: 300, imagen: 'https://cdn.pixabay.com/photo/2017/09/04/18/39/coffee-2714970_960_720.jpg' },
      { id: 2, nombre: 'Latte', precio: 300, imagen: 'https://cdn.pixabay.com/photo/2022/04/15/09/14/coffee-7133980_1280.jpg' },
      { id: 3, nombre: 'Te', precio: 2500, imagen: 'https://cdn.pixabay.com/photo/2016/10/14/18/21/tee-1740871_1280.jpg' },
      { id: 4, nombre: 'Chocolate', precio: 2000, imagen: 'https://cdn.pixabay.com/photo/2015/11/23/11/57/hot-chocolate-1058197_1280.jpg' },
      { id: 5, nombre: 'Frape', precio: 2000, imagen: 'https://cdn.pixabay.com/photo/2020/03/07/05/18/beverage-4908765_1280.jpg' }
    ]
  },
  {
    id: 2,
    nombre: 'Panaderia',
    imagen: 'https://cdn.pixabay.com/photo/2019/03/14/06/37/bread-4054286_960_720.jpg',
    productos: [
      { id: 6, nombre: 'Medialuna', precio: 250, imagen: 'https://cdn.pixabay.com/photo/2018/11/24/23/46/croissant-3836578_1280.jpg' },
      { id: 7, nombre: 'Muffin', precio: 350, imagen: 'https://cdn.pixabay.com/photo/2020/03/06/03/25/red-velvet-cake-4905933_1280.jpg' },
      { id: 8, nombre: 'Cookie', precio: 200, imagen: 'https://cdn.pixabay.com/photo/2015/08/12/17/23/pastries-886098_960_720.jpg' },
      { id: 9, nombre: 'Scone', precio: 3000, imagen: 'https://cdn.pixabay.com/photo/2018/12/12/20/19/scone-3871598_960_720.jpg' }
    ]
  },
  {
    id: 3,
    nombre: 'Jugos',
    imagen: 'https://cdn.pixabay.com/photo/2016/10/09/14/00/vegetable-juices-1725835_960_720.jpg',
    productos: [
      { id: 10, nombre: 'Licuados', precio: 150, imagen: 'https://cdn.pixabay.com/photo/2020/03/02/15/22/ginger-juice-4896003_1280.jpg' },
      { id: 11, nombre: 'Smoothie', precio: 7000, imagen: 'https://cdn.pixabay.com/photo/2020/01/09/04/21/smoothie-4751820_1280.jpg' }
    ]
  },
  {
    id: 4,
    nombre: 'Lunch',
    imagen: 'https://cdn.pixabay.com/photo/2022/02/11/07/03/bento-7006665_960_720.jpg',
    productos: [
      { id: 12, nombre: 'Wrap', precio: 7600, imagen: 'https://cdn.pixabay.com/photo/2022/08/27/14/12/tawook-chicken-sandwich-7414558_960_720.jpg' },
      { id: 13, nombre: 'Ensalada', precio: 3000, imagen: 'https://cdn.pixabay.com/photo/2015/05/31/13/59/salad-791891_1280.jpg' },
      { id: 14, nombre: 'Pizza', precio: 7000, imagen: 'https://cdn.pixabay.com/photo/2016/11/11/00/45/pizza-1815498_960_720.jpg' },
      { id: 15, nombre: 'Hamburguesa', precio: 9000, imagen: 'https://cdn.pixabay.com/photo/2021/09/20/20/47/hamburger-6641821_960_720.jpg' }
    ]
  },
  {
    id: 5,
    nombre: 'Postres',
    imagen: 'https://cdn.pixabay.com/photo/2014/08/26/12/49/the-cake-427920_1280.jpg',
    productos: [
      { id: 16, nombre: 'Pastel', precio: 600, imagen: 'https://cdn.pixabay.com/photo/2020/03/10/03/49/red-velvet-cake-4917734_1280.jpg' },
      { id: 17, nombre: 'Torta Frutos Secos', precio: 600, imagen: 'https://cdn.pixabay.com/photo/2016/08/03/05/35/tea-1565932_960_720.jpg' },
      { id: 18, nombre: 'Torta de Limon', precio: 600, imagen: 'https://cdn.pixabay.com/photo/2017/08/15/14/37/cheesecake-2644161_960_720.jpg' },
      { id: 19, nombre: 'Pastel de Chocolate', precio: 600, imagen: 'https://cdn.pixabay.com/photo/2015/09/04/11/51/cake-921943_960_720.jpg' },
      { id: 20, nombre: 'Macarrones', precio: 3000, imagen: 'https://cdn.pixabay.com/photo/2021/03/04/10/14/macaroons-6067490_1280.jpg' }
      
    ]
  },
  {
    id: 6,
    nombre: 'Merienda',
    imagen: 'https://cdn.pixabay.com/photo/2019/07/14/01/31/bagel-sandwich-4336042_960_720.jpg',
    productos: [
      { id: 21, nombre: 'Panini', precio: 6300, imagen: 'https://cdn.pixabay.com/photo/2015/09/11/07/34/food-935393_1280.jpg' },
      { id: 22, nombre: 'Tostadas', precio: 5300, imagen: 'https://cdn.pixabay.com/photo/2015/07/14/12/56/blackberries-844876_960_720.jpg' },
      { id: 23, nombre: 'Sandwich', precio: 4300, imagen: 'https://cdn.pixabay.com/photo/2013/10/30/17/08/snack-203135_960_720.jpg' }
    ]
  },
  {
    id: 7,
    nombre: 'Desayunos',
    imagen: 'https://cdn.pixabay.com/photo/2015/08/20/20/07/cereal-898073_1280.jpg',
    productos: [
      { id: 24, nombre: 'Macarrones', precio: 3000, imagen: 'https://cdn.pixabay.com/photo/2021/03/04/10/14/macaroons-6067490_1280.jpg' },
      { id: 25, nombre: 'Wafles', precio: 7000, imagen: 'https://cdn.pixabay.com/photo/2020/05/19/20/54/waffles-5192625_960_720.jpg' },
      { id: 26, nombre: 'Cereal con Fruta', precio: 7000, imagen: 'https://cdn.pixabay.com/photo/2014/10/13/15/31/muesli-486832_1280.jpg' }
    ]
  },
  {
    id: 8,
    nombre: 'Varios',
    imagen: 'https://cdn.pixabay.com/photo/2017/04/25/08/04/coffee-beans-2258852_960_720.jpg',
    productos: [
      { id: 27, nombre: 'Molino', precio: 50000, imagen: 'https://cdn.pixabay.com/photo/2018/06/09/23/27/coffee-3465494_960_720.jpg' },
      { id: 28, nombre: 'Cafetera', precio: 35000, imagen: 'https://cdn.pixabay.com/photo/2016/12/05/22/23/coffee-1885073_960_720.jpg' },
      { id: 29, nombre: 'Tazas', precio: 35000, imagen: 'https://cdn.pixabay.com/photo/2014/09/24/17/13/mugs-459324_1280.jpg' },
      { id: 30, nombre: 'Tetera', precio: 65000, imagen: 'https://cdn.pixabay.com/photo/2017/02/24/10/41/tea-2094420_1280.jpg' }
    ]
  }
];



const listaCategorias = document.getElementById('lista-categorias');
const listaProductos = document.getElementById('lista-productos');
const facturaList = document.getElementById('factura');
const subtotalSpan = document.getElementById('subtotal');

// =============================
// üíæ LOCAL STORAGE
// =============================

function guardarEnLocalStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(categorias));
}

function cargarDesdeLocalStorage() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (data) {
    try {
      categorias = JSON.parse(data);
    } catch (e) {
      console.error('Error al parsear datos:', e);
      categorias = [];
    }
  } else {
    guardarEnLocalStorage(); // Guarda los datos por defecto
  }
}
// =============================
// üîç B√öSQUEDA
// =============================
function buscarProductos(nombre) {
  const nombreLower = nombre.toLowerCase();
  return categorias.flatMap(cat =>
    cat.productos.filter(p => p.nombre.toLowerCase().includes(nombreLower))
  );
}

function renderBusqueda(lista) {
  const listaProductos = document.getElementById('resultadosBusqueda');
  if (!listaProductos) {
    console.error('‚ùå No se encontr√≥ el contenedor con id="resultadosBusqueda"');
    return;
  }

  const listaCategorias = document.getElementById('lista-categorias');

  // Mostrar u ocultar resultados y categor√≠as seg√∫n haya b√∫squeda
  if (lista.length === 0) {
    listaProductos.style.display = 'block';
    listaProductos.innerHTML = '<p class="text-light">No se encontraron productos.</p>';
    listaCategorias.style.display = 'none';
    return;
  }

  listaProductos.innerHTML = '';
  listaProductos.style.display = 'flex';
  listaCategorias.style.display = 'none'; // Ocultar categor√≠as durante b√∫squeda

  lista.forEach(prod => {
    const div = document.createElement('div');
    div.className = 'producto position-relative me-3';
    div.innerHTML = `
      <img src="${prod.imagen}" alt="${prod.nombre}">
      <h6>${prod.nombre}</h6>
      <p>$${prod.precio}</p>
    `;
    div.onclick = () => {
      if (!modoEdicion) agregarAFactura(prod.id);
    };
    listaProductos.appendChild(div);
  });
}



// =============================
// üìã RENDERIZADO DE CATEGOR√çAS
// =============================
function renderCategorias() {
  listaCategorias.innerHTML = '';

  categorias.forEach(categoria => {
    const div = document.createElement('div');
    div.className = 'producto categoria-card position-relative';
    div.innerHTML = `
      <img src="${categoria.imagen}" alt="${categoria.nombre}" class="categoria-img">
      <div class="producto-info">
        <h6>${categoria.nombre}</h6>
        <p>${categoria.productos.length} producto(s)</p>
      </div>
      <div class="position-absolute top-0 end-0 p-1 solo-edicion">
        <button class="btn btn-sm btn-outline-primary me-1" onclick="editarCategoria(${categoria.id}, event)">‚úèÔ∏è</button>
        <button class="btn btn-sm btn-outline-danger" onclick="eliminarCategoria(${categoria.id}, event)">üóëÔ∏è</button>
      </div>
    `;

    // Reasignar evento de clic para abrir el modal
    if (!modoEdicion) {
      div.addEventListener('click', () => abrirModalProductosCategoria(categoria.id));
    }

    listaCategorias.appendChild(div);
  });
}


function editarCategoria(id, event) {
  event.stopPropagation(); // para que no abra el modal de productos
  const categoria = categorias.find(c => c.id === id);
  if (!categoria) return;

  document.getElementById('nombreCategoria').value = categoria.nombre;
  document.getElementById('imagenCategoria').value = categoria.imagen;

  // Guardamos el ID en alg√∫n lugar si lo vas a necesitar luego al hacer "submit"
  document.getElementById('formCategoria').setAttribute('data-editar-id', id);

  new bootstrap.Modal(document.getElementById('modalCategoria')).show();
  actualizarBotonesModo();
}



// =============================
// üßæ MODO EDICI√ìN / FACTURACI√ìN
// =============================
function activarModoFacturacion() {
  modoEdicion = false;
  actualizarVistaModo();
  renderCategorias();
  renderProductos();
  actualizarElementosPorModo();  // üëà Esto garantiza que cualquier bot√≥n fuera del render se oculte
  cerrarTodosLosModales();
}

function activarModoEdicion() {
  modoEdicion = true;
  actualizarVistaModo();
  renderCategorias();
  renderProductos();
  actualizarElementosPorModo();  // üëà Igual que arriba
  cerrarTodosLosModales();
}

function actualizarVistaModo() {
  const etiqueta = document.getElementById('modoActual');
  const body = document.body;

  body.classList.toggle('modo-edicion', modoEdicion);
  body.classList.toggle('modo-facturacion', !modoEdicion);

  if (etiqueta) {
    etiqueta.textContent = modoEdicion ? 'Modo: Edici√≥n' : 'Modo: Facturaci√≥n';
    etiqueta.className = modoEdicion ? 'me-3 fw-bold text-danger' : 'me-3 fw-bold text-primary';
  }
}

// =============================
// üß∞ UTILIDADES / MODALES
// =============================
function actualizarBotonesModo() {
  const body = document.body;
  body.classList.toggle('modo-edicion', modoEdicion);
  body.classList.toggle('modo-facturacion', !modoEdicion);
}

function abrirModalNuevaCategoria() {
  // Limpiar campos
  document.getElementById('nombreCategoria').value = '';
  document.getElementById('imagenCategoria').value = '';
  document.getElementById('formCategoria').removeAttribute('data-editar-id');

  // Mostrar el modal y guardar su instancia para poder cerrarlo luego
  const modalEl = document.getElementById('modalCategoria');
  window.modalCategoria = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
  window.modalCategoria.show();
}

function abrirModalProductosCategoria(idCategoria) {
  console.log("Intentando abrir modal para la categor√≠a con ID:", idCategoria);

  const categoria = categorias.find(c => c.id === idCategoria);
  if (!categoria) {
    console.log("Categor√≠a no encontrada");
    return;
  }

  // üîß IMPORTANTE: guardar el ID actual
  categoriaActualId = idCategoria;

  // Actualizar encabezado y contenedor
  const titulo = document.getElementById('nombreCategoriaModal');
  const contenedor = document.getElementById('productosCategoriaContainer');
  const btnAgregar = document.getElementById('btnAgregarProductoCategoria');

  titulo.textContent = `üõçÔ∏è ${categoria.nombre}`;
  contenedor.innerHTML = '';

  // Agregar evento al bot√≥n "Agregar producto"
  btnAgregar.onclick = () => abrirNuevoProducto(idCategoria);

  categoria.productos.forEach(prod => {
    const div = document.createElement('div');
    div.className = 'producto position-relative';

    div.innerHTML = `
      <img src="${prod.imagen}" alt="${prod.nombre}">
      <div class="producto-info">
        <h6>${prod.nombre}</h6>
        <p>$${prod.precio}</p>
        ${
          modoEdicion
            ? `<div class="position-absolute top-0 end-0 p-1 solo-edicion">
                <button class="btn btn-sm btn-outline-primary me-1"
                        onclick="editarProductoCategoria(${idCategoria}, ${prod.id}, event)">‚úèÔ∏è</button>
                <button class="btn btn-sm btn-outline-danger"
                        onclick="eliminarProductoCategoria(${idCategoria}, ${prod.id}, event)">üóëÔ∏è</button>
              </div>`
            : ''
        }
      </div>
    `;

    if (!modoEdicion) {
      div.onclick = () => agregarAFactura(prod.id);
    }

    contenedor.appendChild(div);
  });

  // Mostrar el modal
  const modalEl = document.getElementById('modalCategoriaProductos');
  const modal = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
  modal.show();
}

function manejarCierreModal() {
  console.log("Modal cerrado. Reiniciando eventos...");

  // Quitar backdrop que a veces queda trabado
  document.querySelectorAll('.modal-backdrop').forEach(backdrop => backdrop.remove());

  // Limpiar clases del body
  document.body.classList.remove('modal-open');
  document.body.style.paddingRight = '';

  // Reiniciar eventos de las categor√≠as
  renderCategorias();
}


// Funci√≥n para manejar el cierre del modal
function manejarCierreModal() {
  console.log("Modal cerrado. Reiniciando eventos...");
  // Limpiar el ID de la categor√≠a actual
  categoriaActualId = null; // O el valor que necesites
  renderCategorias(); // Vuelve a renderizar las categor√≠as
}

function asignarEventosModal(idCategoria) {
  const contenedor = document.getElementById('productosCategoriaContainer');
  
  // Asignar eventos a los botones de editar
  contenedor.querySelectorAll('.btn-editar').forEach(btn => {
    btn.onclick = (e) => {
      e.stopPropagation();
      const idProducto = btn.getAttribute('data-idproducto');
      editarProductoCategoria(idCategoria, idProducto, e);
    };
  });

  // Asignar eventos a los botones de eliminar
  contenedor.querySelectorAll('.btn-eliminar').forEach(btn => {
    btn.onclick = (e) => {
      e.stopPropagation();
      const idProducto = btn.getAttribute('data-idproducto');
      eliminarProductoCategoria(idCategoria, idProducto, e);
    };
  });
}

function editarProductoCategoria(idCategoria, idProducto, event) {
  event.stopPropagation();
  
  const categoriaIdNum = parseInt(idCategoria, 10);
  const productoIdNum = parseInt(idProducto, 10);

  const categoria = categorias.find(c => c.id === categoriaIdNum);
  if (!categoria) {
    console.warn('‚ö†Ô∏è Categor√≠a no encontrada:', categoriaIdNum);
    return;
  }

  const producto = categoria.productos.find(p => p.id === productoIdNum);
  if (!producto) {
    console.warn('‚ö†Ô∏è Producto no encontrado:', productoIdNum);
    return;
  }

  document.getElementById('productoId').value = productoIdNum;
  document.getElementById('nombreProducto').value = producto.nombre;
  document.getElementById('precioProducto').value = producto.precio;
  document.getElementById('imagenProducto').value = producto.imagen;
  document.getElementById('categoriaProductoId').value = categoriaIdNum;

  mostrarPreviewImagenes();
  new bootstrap.Modal(document.getElementById('modalProducto')).show();
  actualizarBotonesModo();
}

function eliminarProductoCategoria(idCategoria, idProducto, event) {
  event.stopPropagation();
  const idNum = parseInt(idProducto, 10);
  const catId = parseInt(idCategoria, 10);
  console.log('üóëÔ∏è Eliminando producto ID:', idNum, 'de categor√≠a ID:', catId);

  if (confirm('¬øEliminar producto?')) {
    const categoria = categorias.find(c => c.id === catId);
    if (!categoria) {
      console.error('‚ùå No se encontr√≥ la categor√≠a con ID:', catId);
      return;
    }

    categoria.productos = categoria.productos.filter(p => p.id !== idNum);
    abrirModalProductosCategoria(catId); // Reabrimos el modal para actualizar la vista
    guardarEnLocalStorage(); // Guardar cambios
  }
}

function abrirNuevoProducto(idCategoria = null) {
  document.getElementById('productoId').value = '';
  document.getElementById('nombreProducto').value = '';
  document.getElementById('precioProducto').value = '';
  document.getElementById('imagenProducto').value = '';
  document.getElementById('imagenLocal').value = '';

  mostrarPreviewImagenes();

  document.getElementById('formProducto').setAttribute('data-categoria-id', idCategoria || categoriaActualId);
  new bootstrap.Modal(document.getElementById('modalProducto')).show();
}

// =============================
// üì§ CRUD PRODUCTOS / CATEGOR√çAS
// =============================
function eliminarCategoria(id, event) {
  event.stopPropagation();
  if (confirm('¬øEliminar esta categor√≠a y todos sus productos?')) {
    categorias = categorias.filter(c => c.id !== id);
    renderCategorias();
    guardarEnLocalStorage();
  }
}


// =============================
// üñºÔ∏è IMAGENES / PREVIEW
// =============================
function mostrarPreviewImagenes() {
  const contenedor = document.getElementById('previewImagenes');
  contenedor.innerHTML = '';
  const urlsUnicas = [...new Set(categorias.flatMap(cat => cat.productos.map(p => p.imagen)))];

  urlsUnicas.forEach(url => {
    const img = document.createElement('img');
    img.src = url;
    img.title = 'Click para usar esta imagen';
    Object.assign(img.style, {
      width: '64px',
      height: '64px',
      objectFit: 'cover',
      border: '2px solid transparent',
      borderRadius: '6px',
      cursor: 'pointer',
      marginRight: '8px'
    });
    img.onclick = () => {
      document.getElementById('imagenProducto').value = url;
    };
    contenedor.appendChild(img);
  });
}

// =============================
// üßæ FORMULARIOS / EVENTOS
// =============================
document.getElementById('formCategoria').addEventListener('submit', function (e) {
  e.preventDefault();

  const idEditar = this.getAttribute('data-editar-id');
  const nombre = document.getElementById('nombreCategoria').value;
  const imagen = document.getElementById('imagenCategoria').value || 'https://cdn-icons-png.flaticon.com/512/1046/1046784.png';

  if (idEditar) {
    // Editar categor√≠a
    const categoria = categorias.find(c => c.id == idEditar);
    if (categoria) {
      categoria.nombre = nombre;
      categoria.imagen = imagen;
    }
    this.removeAttribute('data-editar-id');
  } else {
    // Crear nueva categor√≠a
    categorias.push({
      id: Date.now(),
      nombre,
      imagen,
      productos: []
    });
  }

  guardarEnLocalStorage();
  renderCategorias();

  // ‚úÖ Cerrar el modal de forma segura
  const modalEl = document.getElementById('modalCategoria');
  const modal = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
  modal.hide();

  actualizarVistaModo();
  actualizarBotonesModo();
});

// Modificar el manejo del formulario de productos
document.getElementById('formProducto').addEventListener('submit', function (e) {
  e.preventDefault();

  const id = document.getElementById('productoId').value;
  const nombre = document.getElementById('nombreProducto').value;
  const precio = parseFloat(document.getElementById('precioProducto').value);
  const imagen = document.getElementById('imagenProducto').value || 'https://cdn-icons-png.flaticon.com/512/1046/1046784.png';
  const idCategoria = document.getElementById('categoriaProductoId').value;

  const categoria = categorias.find(c => c.id == idCategoria);
  if (!categoria) {
    alert("Error: Categor√≠a no encontrada.");
    return;
  }

  if (id) {
    const prod = categoria.productos.find(p => p.id == id);
    if (prod) {
      prod.nombre = nombre;
      prod.precio = precio;
      prod.imagen = imagen;
    }
  } else {
    categoria.productos.push({
      id: Date.now(),
      nombre,
      precio,
      imagen
    });
  }

  guardarEnLocalStorage();
  renderCategorias();
  actualizarBotonesModo();

  // Referencia al modal de producto
  const modalProductoEl = document.getElementById('modalProducto');
  const modalProducto = bootstrap.Modal.getInstance(modalProductoEl) || new bootstrap.Modal(modalProductoEl);

  // Desenfocar elemento activo antes del cierre
  if (document.activeElement) {
    document.activeElement.blur();
  }

  // Escuchar evento de cierre completo antes de reabrir otro
  modalProductoEl.addEventListener('hidden.bs.modal', function handler() {
    modalProductoEl.removeEventListener('hidden.bs.modal', handler); // evitar m√∫ltiples ejecuciones

    // Limpieza del estado
    manejarCierreModal();

    // Reabrir el modal de productos de la categor√≠a actual
    abrirModalProductosCategoria(categoria.id);
  });

  // Cerrar el modal
  modalProducto.hide();
});



document.getElementById('imagenLocal').addEventListener('change', function (event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      document.getElementById('imagenProducto').value = e.target.result;
      mostrarPreviewImagenes();
    };
    reader.readAsDataURL(file);
  }
});

// =============================
// üîê MODO EDICI√ìN CON CLAVE
// =============================
function solicitarClaveEdicion() {
  const clave = prompt("Ingrese la clave para activar el modo edici√≥n:");
  const claveCorrecta = "admin123"; // Pod√©s cambiarla

  if (clave === claveCorrecta) {
    activarModoEdicion();
  } else {
    alert("Clave incorrecta. No se activ√≥ el modo edici√≥n.");
  }
}

// =============================
// ‚¨áÔ∏è NAVBAR FLOTANTE INFERIOR
// =============================
document.addEventListener('mousemove', function (e) {
  const navbar = document.querySelector('.navbar-inferior');
  if (window.innerHeight - e.clientY < 50) {
    navbar.style.opacity = 1;
    navbar.style.pointerEvents = 'auto';
  } else {
    navbar.style.opacity = 0;
    navbar.style.pointerEvents = 'none';
  }
});

// =============================
// üîÑ INICIALIZACI√ìN
// =============================
document.addEventListener('DOMContentLoaded', () => {
  // Inicializar datos
  localStorage.removeItem(STORAGE_KEY);
  cargarDesdeLocalStorage();
  renderCategorias();

  // Activar modo despu√©s de carga
  setTimeout(() => {
    console.log('Activando modo...');
    activarModoFacturacion(); // o activarModoEdicion();
  }, 50);

  // Buscador de productos
  const inputBusqueda = document.getElementById('busquedaProducto');
  const listaProductos = document.getElementById('resultadosBusqueda');
  const listaCategorias = document.getElementById('lista-categorias');

  inputBusqueda.addEventListener('input', (e) => {
    const texto = e.target.value.trim();

    if (texto === '') {
      listaProductos.style.display = 'none';
      listaCategorias.style.display = 'flex';
      listaProductos.innerHTML = '';
    } else {
      const resultados = buscarProductos(texto);
      renderBusqueda(resultados);
    }
  });

  // ‚úÖ Activar el bot√≥n "Nueva Categor√≠a"
  document.getElementById('btnNuevaCategoria').addEventListener('click', abrirModalNuevaCategoria);
});

// ==================================
// EDICION DEL FONDO Y NOMBRE EMPRESA
// ==================================
      modoEdicion = true; // Bien
    
      function solicitarClaveEdicion() {
        const clave = prompt("Ingrese la clave para activar el modo edici√≥n:");
        const claveCorrecta = "admin123"; // Cambiala si quer√©s
    
        if (clave === claveCorrecta) {
          activarModoEdicion();
        } else {
          alert("Clave incorrecta. No se activ√≥ el modo edici√≥n.");
        }
      }
    
      function activarModoEdicion() {
        modoEdicion = true;
        console.log("üîß Modo edici√≥n ACTIVADO");
    
        const configBtn = document.getElementById('btnConfigNegocio');
        if (configBtn) configBtn.style.display = 'inline-block';
    
        const btnNuevo = document.getElementById('btnAgregarProductoCategoria');
        if (btnNuevo) btnNuevo.style.display = 'inline-block';
    
        if (typeof renderProductos === 'function') {
          renderProductos();
        }
    
        if (typeof actualizarVistaModo === 'function') {
          actualizarVistaModo();
        }
    
        alert('üîì Modo edici√≥n activado');
      }
    
      function activarModoFacturacion() {
        modoEdicion = false;
        document.getElementById('btnAgregarProductoCategoria').style.display = 'none';
        document.getElementById('btnConfigNegocio').style.display = 'none';
        actualizarVistaModo();
      }
    
      function abrirModalConfiguracion() {
        const nombreActual = localStorage.getItem('nombreNegocio') || 'Coffee Store';
        const imagenActual = localStorage.getItem('imagenFondo') || '';
        const colorActual = localStorage.getItem('colorTexto') || '#000000';
    
        document.getElementById('nuevoNombreNegocio').value = nombreActual;
        document.getElementById('nuevaImagenFondo').value = imagenActual;
        document.getElementById('colorTexto').value = colorActual;
    
        const modal = new bootstrap.Modal(document.getElementById('modalConfiguracion'));
        modal.show();
      }
    
      document.getElementById('formConfiguracion').addEventListener('submit', function (e) {
        e.preventDefault();
    
        const nuevoNombre = document.getElementById('nuevoNombreNegocio').value.trim();
        const nuevaImagen = document.getElementById('nuevaImagenFondo').value.trim();
        const nuevoColor = document.getElementById('colorTexto').value;
    
        if (nuevoNombre) {
          localStorage.setItem('nombreNegocio', nuevoNombre);
          document.getElementById('nombreNegocioTexto').textContent = nuevoNombre;
        }
    
        if (nuevaImagen) {
          localStorage.setItem('imagenFondo', nuevaImagen);
          document.body.style.backgroundImage = `url('${nuevaImagen}')`;
    
          const fondo = document.querySelector('.bg-body');
          if (fondo) fondo.style.backgroundImage = `url('${nuevaImagen}')`;
        }
    
        if (nuevoColor) {
          localStorage.setItem('colorTexto', nuevoColor);
          aplicarColorTexto(nuevoColor);
        }
    
        const modal = bootstrap.Modal.getInstance(document.getElementById('modalConfiguracion'));
        modal.hide();
      });
    
      function aplicarColorTexto(color) {
        // Encabezados
        document.querySelectorAll('h1, h2, h3, h4, h5, h6').forEach(el => {
          el.style.color = color;
        });
      
        // Elementos <strong> como el de Subtotal
        document.querySelectorAll('strong').forEach(el => {
          el.style.color = color;
        });
      
        // Si quer√©s agregar m√°s clases espec√≠ficas:
        document.querySelectorAll('.titulo-dinamico, .factura-box div').forEach(el => {
          el.style.color = color;
        });
      }
      
    
      document.addEventListener('DOMContentLoaded', () => {
        const nombre = localStorage.getItem('nombreNegocio');
        const imagen = localStorage.getItem('imagenFondo');
        const colorTexto = localStorage.getItem('colorTexto');
    
        if (nombre) {
          document.getElementById('nombreNegocioTexto').textContent = nombre;
        }
    
        if (imagen) {
          document.body.style.backgroundImage = `url('${imagen}')`;
    
          const fondo = document.querySelector('.bg-body');
          if (fondo) fondo.style.backgroundImage = `url('${imagen}')`;
        }
    
        if (colorTexto) {
          aplicarColorTexto(colorTexto);
        }
        renderCategorias();
      });
    </script>

          
 

<script>
  // Habilitar uso del teclado para la calculadora
      let calculoActual = '';

      function abrirCalculadora() {
        calculoActual = '';
        document.getElementById('calcDisplay').value = '';
        const modal = new bootstrap.Modal(document.getElementById('modalCalculadora'));
        modal.show();
      }

      function agregarCalc(valor) {
        calculoActual += valor;
        document.getElementById('calcDisplay').value = calculoActual;
      }

      function borrarCalc() {
        calculoActual = '';
        document.getElementById('calcDisplay').value = '';
      }

      function calcular() {
        try {
          const resultado = eval(calculoActual);
          calculoActual = resultado;
          document.getElementById('calcDisplay').value = resultado;
        } catch {
          document.getElementById('calcDisplay').value = 'Error';
          calculoActual = '';
        }
      }
      // Habilitar uso del teclado para la calculadora
      document.addEventListener('keydown', function (event) {
        const modal = document.getElementById('modalCalculadora');
        const isVisible = modal.classList.contains('show');
        if (!isVisible) return; // Solo si el modal est√° abierto

        const tecla = event.key;

        if (!isNaN(tecla) || ['+', '-', '*', '/', '.'].includes(tecla)) {
          agregarCalc(tecla);
        } else if (tecla === 'Enter') {
          calcular();
        } else if (tecla === 'Backspace') {
          calculoActual = calculoActual.slice(0, -1);
          document.getElementById('calcDisplay').value = calculoActual;
        } else if (tecla.toLowerCase() === 'c') {
          borrarCalc();
        }
      });

      document.getElementById('busquedaProducto').addEventListener('input', (e) => {
        const texto = e.target.value.trim();
        const listaProductos = document.getElementById('resultadosBusqueda'); // Aseg√∫rate de que el contenedor sea 'resultadosBusqueda'
      
        if (texto === '') {
          // üßπ Vaciar productos si no hay b√∫squeda
          listaProductos.innerHTML = '';  // Ahora se actualiza 'resultadosBusqueda'
        } else {
          const resultados = buscarProductos(texto);
          renderBusqueda(resultados);
        }
      });
      
    </script>

    
    <!-- JS de Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  </body>
  
</html>
